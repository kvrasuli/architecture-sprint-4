### Мотивация

Логирование в целом нужно для тех же целей, что и мониторинг с трейсингом, повышать наблюдаемость системы
(отслеживать метрики, следить за состоянием системы, быстро реагировать на ошибки, и исправлять их)

Логировать в первую очередь будем критические ошибки на сервисах (уровень ERROR и выше), а также запросы и ответы
(внешние, внутренние с фронта, запросы между сервисами)
Метрики, на которые повлияет внедрение логирование
- количество застрявших заказов
- количество успешных заказов
- время нахождения в том или ином статусе
- время обработки заказа (среднее, максимальное) по timestamp

### Предлагаемое решение
- По коду backend сервисов в критичных и интересных для наблюдения местах (например, измение статуса заказа, отмена заказа)
разработчик расставляет запись информации в лог. С каждым сервисом рядом (например в том же поде) устанавливаем filebeat
который из файла с логами отправляет их в logstash, настраиваем соответствующий индекс, далее наблюдаем логи сервисов в кибане
- Логи уровня инфо на сервисах - записи об изменениях статусов заказов, в них нужно включить контекст
  * id заказа
  * timestamp
  * x-request-id
  * код предыдущего статуса
- Срок хранения логов 30 дней, чтобы иметь историю логов, тк цепочка запросов по заказу может идти несколько дней, под хранилище стоит заложить 20Гб,
посчитать точно сложно без знания текущей нагрузки, нужно настроить удаление самых старых логов при заполнении хранилища логов
- Используем 2 индекса, для filebeat на сервисах и для логов запросов и ответов

- Логирование запросов и ответов: устанавливаем какой нибудь API Management, все запросы (внешние и внутренние) проходят через него
Он пишет свои логи, касающиеся запросов и ответов, наблюдаем их в отдельном индексе в Kibana

- Составляем список чувствительных и персональных данных, настраиваем маскирование в кибана, чтобы данные скрывались под *
Доступ к кибане предоставляется только пользователям во внутренней сети (VPN), плюс настраивается сетевая связность с компьютера юзера
до кибаны, в кибане заводится персонализированная учетка (для разработчиков, тестировщиков)

- Алерты можно настроить по порогу на коды ответов 5хх, на логи уровнять ERROR и выше

- Схема в корне проекта ./jewerly_c4_model.drawio
